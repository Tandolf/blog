{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/base64-in-rust/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby Starter Blog"}},"markdownRemark":{"id":"e6d94328-9aed-52ea-8470-6137cf37c2d0","excerpt":"I have a confession to make. Please don’t think any less of me, but i have never really understood how Base64 actually works. I know what it is used for. I know…","html":"<p>I have a confession to make. Please don’t think any less of me, but i have never really understood how Base64 <em>actually</em> works. I know what it is used for. I know when to use it and I have a vague understanding of how it is implemented, but i have never <strong>fully</strong> understood it. Until now.</p>\n<p>I was looking at new things to implement and i stumbled across the <a href=\"https://www.rfc-editor.org/rfc/rfc4648\">rfc for Base64</a> and thought to myself. <em>Maybe I can implement this, in rust</em>. So i sat down and read <a href=\"https://www.rfc-editor.org/rfc/rfc4648\">rfc 4648</a> and started to understand how it actually works. I then googled a bit and looked at other implementations.</p>\n<p>So in this post im going to try to explain what base64 is, a bit of how it works, and then we are going to implement a simple encoder and decoder.</p>\n<h2>What is it used for?</h2>\n<p>Lets look at how <a href=\"https://en.wikipedia.org/wiki/Base64\">wikipedia</a> describes base64.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Base64 is designed to carry data stored in binary formats across channels that only reliably support text content.</code></pre></div>\n<p>When we send information on the internet all servers can’t accept all formats of data. But one thing in common is that most servers can accept data in the form of text. This is where base64 comes into play. If a server can’t accept a certain format, we can always send the data as a textual representation of the data, then the server can accept the text and convert it into whatever format it needs to be on its and.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Important, Base64 is NOT encryption, its an encoding schema. We convert it to something and have the ability to convert \nit back. Don't ever use Base64 on passwords etc. and think it will protect you, anyone can decode Base64.</code></pre></div>\n<p>On the world wide web, base64 is very common to use when wanting to send send files like images and and css files using base64 as a textual representation of the data instead of sending the data itself. For instance you commonly use it when you want send email attachments and this is because the original SMTP protocol only supported <a href=\"https://en.wikipedia.org/wiki/ASCII\">7-bit ascii</a> so there was a need to be able to represent data as text when sending emails.</p>\n<p>Image below shows how base64 could be used when sending an image from one server to another server.</p>\n<div class=\"mermaid\">graph LR\n    A(\"image -> base64(image)\")-- encoded-data -->B(\"base64(image) -> image\")</div>\n<ul>\n<li>We encode our data into base64, a textual representation of the data.</li>\n<li>We send that data to a receiving server or client</li>\n<li>The server/client decodes the base64 encoded data and recreates the original data on the other side.</li>\n</ul>\n<h2>So what is base64 actually?</h2>\n<p>On the internet there is a saying which goes as follows, <em>“there is no such thing as plain text”</em>. which is completely true. In the computer world all text is represented by 0 and 1’s. But if we have a series of bits then what text it represents depends on how we look at the bits. 3 bytes, represent 24 bits, (1 byte = 8 bits). But we can also think of 24 bits as 4 groups of 6 bits.</p>\n<p>Here i’ll show you a visual representation taken straight out of the rfc which shows what im talking about.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">+--first octet--+-second octet--+--third octet--+\n<span class=\"token operator\">|</span><span class=\"token number\">7</span> <span class=\"token number\">6</span> <span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">7</span> <span class=\"token number\">6</span> <span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">7</span> <span class=\"token number\">6</span> <span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span>\n+-----------+---+-------+-------+---+-----------+\n<span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span>\n+--1.index--+--2.index--+--3.index--+--4.index--+</code></pre></div>\n<p>As you can see here is that depending on how you decide to create your groups you can represent 24 bits as either 3 groups of 8 bits, or 4 groups of 6 bits. And this is the entire basics of the encoding and decoding using the base64 system.</p>\n<p>You see 8 bits can represent 256 different numbers. While 6 bits can only represent 64. This means that if we take any binary representation of text and instead look at it as in groups of 6 bits. And then map these 64 numbers to a given set of letters. We suddenly have a way of encoding any data into a limited textual representation. This can then be sent to someone that maybe only can receive limited character set, to later be converted back into something more elaborate like for instance the russian or chinese alphabet.</p>\n<p>So what letters are we representing with our limited set of 64 numbers?</p>\n<p>The rfc show us just that.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">                    The Base <span class=\"token number\">64</span> Alphabet\n\n Value Encoding  Value Encoding  Value Encoding  Value Encoding\n         <span class=\"token number\">0</span> A            <span class=\"token number\">17</span> R            <span class=\"token number\">34</span> i            <span class=\"token number\">51</span> z\n         <span class=\"token number\">1</span> B            <span class=\"token number\">18</span> S            <span class=\"token number\">35</span> j            <span class=\"token number\">52</span> <span class=\"token number\">0</span>\n         <span class=\"token number\">2</span> C            <span class=\"token number\">19</span> T            <span class=\"token number\">36</span> k            <span class=\"token number\">53</span> <span class=\"token number\">1</span>\n         <span class=\"token number\">3</span> D            <span class=\"token number\">20</span> U            <span class=\"token number\">37</span> l            <span class=\"token number\">54</span> <span class=\"token number\">2</span>\n         <span class=\"token number\">4</span> E            <span class=\"token number\">21</span> V            <span class=\"token number\">38</span> m            <span class=\"token number\">55</span> <span class=\"token number\">3</span>\n         <span class=\"token number\">5</span> F            <span class=\"token number\">22</span> W            <span class=\"token number\">39</span> n            <span class=\"token number\">56</span> <span class=\"token number\">4</span>\n         <span class=\"token number\">6</span> G            <span class=\"token number\">23</span> X            <span class=\"token number\">40</span> o            <span class=\"token number\">57</span> <span class=\"token number\">5</span>\n         <span class=\"token number\">7</span> H            <span class=\"token number\">24</span> Y            <span class=\"token number\">41</span> p            <span class=\"token number\">58</span> <span class=\"token number\">6</span>\n         <span class=\"token number\">8</span> I            <span class=\"token number\">25</span> Z            <span class=\"token number\">42</span> q            <span class=\"token number\">59</span> <span class=\"token number\">7</span>\n         <span class=\"token number\">9</span> J            <span class=\"token number\">26</span> a            <span class=\"token number\">43</span> r            <span class=\"token number\">60</span> <span class=\"token number\">8</span>\n        <span class=\"token number\">10</span> K            <span class=\"token number\">27</span> b            <span class=\"token number\">44</span> s            <span class=\"token number\">61</span> <span class=\"token number\">9</span>\n        <span class=\"token number\">11</span> L            <span class=\"token number\">28</span> c            <span class=\"token number\">45</span> t            <span class=\"token number\">62</span> +\n        <span class=\"token number\">12</span> M            <span class=\"token number\">29</span> d            <span class=\"token number\">46</span> u            <span class=\"token number\">63</span> /\n        <span class=\"token number\">13</span> N            <span class=\"token number\">30</span> e            <span class=\"token number\">47</span> <span class=\"token function\">v</span>\n        <span class=\"token number\">14</span> O            <span class=\"token number\">31</span> f            <span class=\"token number\">48</span> w         <span class=\"token punctuation\">(</span>pad<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span>\n        <span class=\"token number\">15</span> P            <span class=\"token number\">32</span> g            <span class=\"token number\">49</span> x\n        <span class=\"token number\">16</span> Q            <span class=\"token number\">33</span> h            <span class=\"token number\">50</span> y\n</code></pre></div>\n<p>Here we can see the defined base64 alphabet. So by mapping each group of 6 bits to a number between 0-64 (using binary to real number conversion) we can then select the correct letter and in the end encode our data with a limited text range.</p>\n<h2>Padding</h2>\n<p>You can often spot a base64 string because its very common that the a base64 text representation ends with one or two equal signs (=). You see that in order for us to convert something we need to bits to line up.</p>\n<p>Data that isn’t suitable for conversion.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">+--first octet--+-second octet--+\n<span class=\"token operator\">|</span><span class=\"token number\">7</span> <span class=\"token number\">6</span> <span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">7</span> <span class=\"token number\">6</span> <span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span>\n+-----------+---+-------+-------+---+\n<span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span>\n+--1.index--+--2.index--+--3.index--+</code></pre></div>\n<p>Here you can see that the data provided can’t really be converted since it it doesn’t evenly add up, so in these cases we often need to pad out the data by adding padding data. We usually add one or many <code class=\"language-text\">null</code> values to pad out. This padding will in the textual representation be shown as a <code class=\"language-text\">=</code> character.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">+--first octet--+-second octet--+--third octet--+\n<span class=\"token operator\">|</span><span class=\"token number\">7</span> <span class=\"token number\">6</span> <span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">7</span> <span class=\"token number\">6</span> <span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span> P A D D I N G <span class=\"token operator\">|</span>\n+-----------+---+-------+-------+---+-----------+\n<span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">5</span> <span class=\"token number\">4</span> <span class=\"token number\">3</span> <span class=\"token number\">2</span> <span class=\"token number\">1</span> <span class=\"token number\">0</span><span class=\"token operator\">|</span>\n+--1.index--+--2.index--+--3.index--+--4.index--+</code></pre></div>\n<p>So in the above example we added a single padding character to the end of the data so that the conversion in the end adds up evenly. The padding character in the base64 alphabet is represented by an <em>equal sign</em> and at most you need 2 equal signs in the and, which gives a base64 encoded string its classic look of a text string ending with up to 2 equal signs.</p>\n<p>Some examples of strings that needed to be padded to be fit for encoding, notice the different amount of equal signs at the end.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">BASE64<span class=\"token punctuation\">(</span><span class=\"token string\">\"foob\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Zm9vYg==\"</span>\n\nBASE64<span class=\"token punctuation\">(</span><span class=\"token string\">\"fooba\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Zm9vYmE=\"</span>\n\nBASE64<span class=\"token punctuation\">(</span><span class=\"token string\">\"foobar\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"Zm9vYmFy\"</span></code></pre></div>\n<p>Here is an example of how we solve this problem in code.</p>\n<p>Below We check that the supplied data bytes are devisable by 3, if not we add the corresponding padding (1 or 2) <code class=\"language-text\">null</code> characters to the end of the supplied data, so that we can encode the data properly. Then at the end, of this code snippet, we remove the added padding and replace it with proper equal signs to show that we have padded our data.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// check if we need to add padding or not</span>\n<span class=\"token keyword\">let</span> input_length <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">chars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">%</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> padding<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">if</span> input_length <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> input_length<span class=\"token punctuation\">..</span><span class=\"token number\">3</span> <span class=\"token punctuation\">{</span>\n        padding<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token char\">'='</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token comment\">// add null values to pad out the data</span>\n        input<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token char\">'\\0'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Code for encoding the data, omitted for abbr.</span>\n\n<span class=\"token comment\">// strip the null values after encoding</span>\n<span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> result<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span> <span class=\"token operator\">=</span> result<span class=\"token punctuation\">.</span><span class=\"token function\">chars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">take</span><span class=\"token punctuation\">(</span>result_length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// add on the correct number of equal signs to the and of the encoded string</span>\nresult<span class=\"token punctuation\">.</span><span class=\"token function\">push_str</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>padding<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Lets write an encoder</h2>\n<p>To encode some data into base 64, we are going to split this up into 4 different steps. I will explain the steps as we go, but we will start out by creating a loop that will extract out 3 bytes at a time in a loop. Because as we explained earlier, we want to convert 3 groups of 8 bits, into 4 groups of 6 bytes.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> value_bytes <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">as_bytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> value_iter <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">chars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">enumerate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">step_by</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> value_iter <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">let</span> char_number <span class=\"token operator\">=</span> value_bytes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> char_number1 <span class=\"token operator\">=</span> value_bytes<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> char_number2 <span class=\"token operator\">=</span> value_bytes<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> n<span class=\"token punctuation\">:</span> <span class=\"token keyword\">u32</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>char_number <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>char_number1 <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>char_number2 <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Most of the code above is easy to understand except for maybe the last line. What we do in that last line is that we get the first 3 bytes, we then cast and bit shift each byte into its own “space” in a u32 representation.</p>\n<p>Lastly we add them all together, so they all fit together nicely in their own space. The below representation shows how it works visually.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// We extract a byte (for example FF which is hex value of the numeric value 255)\n1111 1111\n\n// we then cast the value to a u32 (32bits) so we get some free space\n0000 0000 0000 0000 0000 0000 1111 1111\n\n// then we shift the value 16 steps to the left\n0000 0000 1111 1111 0000 0000 0000 0000\n\n// We do the same with the second value but only shift it 8 bits\n0000 0000 0000 0000 1111 1111 0000 0000\n\n// the last value we only cast to a u32 (32 bits)\n0000 0000 0000 0000 0000 0000 1111 1111\n\n// we then add them all together and each byte gets their own space\n0000 0000 1111 1111 1111 1111 1111 1111</code></pre></div>\n<p>So now we have a 32 bit representation of our 3 first bytes. Time to do the conversion, and we do it by doing some more bit shifting.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> n<span class=\"token punctuation\">:</span> <span class=\"token keyword\">u32</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>char_number <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>char_number1 <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">8</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>char_number2 <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> n1 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">>></span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x3F</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> n2 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">>></span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x3F</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> n3 <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>n <span class=\"token operator\">>></span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x3F</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> n4 <span class=\"token operator\">=</span> n <span class=\"token operator\">&amp;</span> <span class=\"token number\">0x3F</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>To extract our 4, 6-bit numbers from our 32-bit number we need to do some more bit shifting. The above code does this, but if you read below the steps are explained but using the bit representations to show it more graphically.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">// We start out with our newly created <span class=\"token number\">32</span> bit number\n0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n\n   // We <span class=\"token keyword\">then</span> bit <span class=\"token builtin class-name\">shift</span> it down <span class=\"token number\">18</span> steps and mask off everything above the 6th bit\n   0000 0000 0000 0000 0000 0000 0011 <span class=\"token number\">1111</span>\n<span class=\"token operator\">&amp;</span>  0000 0000 0000 0000 0000 0000 0011 <span class=\"token number\">1111</span>\n------------------------------------------\n   0000 0000 0000 0000 0000 0000 0011 <span class=\"token number\">1111</span>\n\n   // second value is created by a <span class=\"token builtin class-name\">shift</span> by <span class=\"token number\">12</span> steps down and masked the same way\n   0000 0000 0000 0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n<span class=\"token operator\">&amp;</span>  0000 0000 0000 0000 0000 0000 0011 <span class=\"token number\">1111</span>\n------------------------------------------\n   0000 0000 0000 0000 0000 0000 0011 <span class=\"token number\">1111</span>\n\n   // third we instead bit <span class=\"token builtin class-name\">shift</span> by <span class=\"token number\">6</span> and mask off\n   0000 0000 0000 0011 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n<span class=\"token operator\">&amp;</span>  0000 0000 0000 0000 0000 0000 0011 <span class=\"token number\">1111</span>\n------------------------------------------\n   0000 0000 0000 0000 0000 0000 0011 <span class=\"token number\">1111</span>\n\n   // And finally we don't <span class=\"token function\">touch</span> the original value but mask it to get the last value\n   0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n<span class=\"token operator\">&amp;</span>  0000 0000 0000 0000 0000 0000 0011 <span class=\"token number\">1111</span>\n------------------------------------------\n   0000 0000 0000 0000 0000 0000 0011 <span class=\"token number\">1111</span></code></pre></div>\n<p>Now that we have our 4 new values, we can do a simple lookup table check to see what letter our new values represents and create as new string from it.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">const</span> <span class=\"token constant\">BASE64_CHARS</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">char</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">[</span>\n    <span class=\"token char\">'A'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'B'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'C'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'D'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'E'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'F'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'G'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'H'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'I'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'J'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'K'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'L'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'M'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'N'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'O'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'P'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'Q'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'R'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'S'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token char\">'T'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'U'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'V'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'W'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'X'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'Y'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'Z'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'a'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'b'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'c'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'d'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'e'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'f'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'g'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'h'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'i'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'j'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'k'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'l'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token char\">'m'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'n'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'o'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'p'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'q'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'r'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'s'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'t'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'u'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'v'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'w'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'x'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'y'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'z'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'0'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'2'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'3'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'4'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token char\">'5'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'6'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'7'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'8'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'9'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'+'</span><span class=\"token punctuation\">,</span> <span class=\"token char\">'/'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> c1 <span class=\"token operator\">=</span> <span class=\"token constant\">BASE64_CHARS</span><span class=\"token punctuation\">[</span>n1 <span class=\"token keyword\">as</span> <span class=\"token keyword\">usize</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> c2 <span class=\"token operator\">=</span> <span class=\"token constant\">BASE64_CHARS</span><span class=\"token punctuation\">[</span>n2 <span class=\"token keyword\">as</span> <span class=\"token keyword\">usize</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> c3 <span class=\"token operator\">=</span> <span class=\"token constant\">BASE64_CHARS</span><span class=\"token punctuation\">[</span>n3 <span class=\"token keyword\">as</span> <span class=\"token keyword\">usize</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> c4 <span class=\"token operator\">=</span> <span class=\"token constant\">BASE64_CHARS</span><span class=\"token punctuation\">[</span>n4 <span class=\"token keyword\">as</span> <span class=\"token keyword\">usize</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\nresult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>c1<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nresult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>c2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nresult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>c3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nresult<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>c4<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>And then a Decoder</h2>\n<p>To decode, we basically just need to remove the padding, and then do the entire process but in reverse. One thing to remember is that before the decoder process can be run you will probably want to do some validation to make sure that what you are about to decode is a proper base64 string. I wont show that code here, but doing a regexp check that it includes only the allowed characters from the base64 alphabet will usually suffice.</p>\n<p>So we start out by stripping off the padding, and replacing the equal signs with something else. Anything will work.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> suffix <span class=\"token operator\">=</span> <span class=\"token keyword\">if</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">ends_with</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"==\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"AA\"</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">ends_with</span><span class=\"token punctuation\">(</span><span class=\"token char\">'='</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"A\"</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// remove the equal signs</span>\n<span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> input <span class=\"token operator\">=</span> input<span class=\"token punctuation\">[</span><span class=\"token punctuation\">..</span>input<span class=\"token punctuation\">.</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> suffix<span class=\"token punctuation\">.</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">to_string</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// push new characters on the end if needed</span>\ninput<span class=\"token punctuation\">.</span><span class=\"token function\">push_str</span><span class=\"token punctuation\">(</span>suffix<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>After the padding has been replaced, we enumerate, but this time 4 bytes at a time (instead of 3 like we did during the encoding process). We then get the value of each of the bytes and check their indexes in our array of Base64 characters that we used earlier.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> value_bytes <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">as_bytes</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> <span class=\"token keyword\">mut</span> bytes <span class=\"token operator\">=</span> <span class=\"token class-name\">Vec</span><span class=\"token punctuation\">::</span><span class=\"token function\">new</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> input_iter <span class=\"token operator\">=</span> input<span class=\"token punctuation\">.</span><span class=\"token function\">chars</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">enumerate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">step_by</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">,</span> _<span class=\"token punctuation\">)</span> <span class=\"token keyword\">in</span> input_iter <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> v <span class=\"token operator\">=</span> <span class=\"token class-name\">Decoder</span><span class=\"token punctuation\">::</span><span class=\"token function\">index_of</span><span class=\"token punctuation\">(</span>value_bytes<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> v1 <span class=\"token operator\">=</span> <span class=\"token class-name\">Decoder</span><span class=\"token punctuation\">::</span><span class=\"token function\">index_of</span><span class=\"token punctuation\">(</span>value_bytes<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> v2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Decoder</span><span class=\"token punctuation\">::</span><span class=\"token function\">index_of</span><span class=\"token punctuation\">(</span>value_bytes<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">let</span> v3 <span class=\"token operator\">=</span> <span class=\"token class-name\">Decoder</span><span class=\"token punctuation\">::</span><span class=\"token function\">index_of</span><span class=\"token punctuation\">(</span>value_bytes<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">3</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">fn</span> <span class=\"token function-definition function\">index_of</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">:</span> <span class=\"token keyword\">u8</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">-></span> <span class=\"token keyword\">usize</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">BASE64_CHARS</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">iter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">position</span><span class=\"token punctuation\">(</span><span class=\"token closure-params\"><span class=\"token closure-punctuation punctuation\">|</span>c<span class=\"token closure-punctuation punctuation\">|</span></span> c <span class=\"token operator\">==</span> <span class=\"token operator\">&amp;</span><span class=\"token punctuation\">(</span>input <span class=\"token keyword\">as</span> <span class=\"token keyword\">char</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Like before, we bit shift and mask, but this time we do it a little bit different because we want to go from 4 bytes, to 3 bytes per group.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> n<span class=\"token punctuation\">:</span> <span class=\"token keyword\">u32</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>v <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">18</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>v1 <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">12</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>v2 <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token number\">6</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span>v3 <span class=\"token keyword\">as</span> <span class=\"token keyword\">u32</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This time though, we need to shift things a little bit differently.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// We extract a byte but this has only 6 bits in a 8 bit space\n0011 1111\n\n// we then cast the alphabetic value to a u32 (32bits)\n0000 0000 0000 0000 0000 0000 0011 1111\n\n// then we shift the value 18 steps to the left\n0000 0000 1111 1100 0000 0000 0000 0000\n\n// We do the same with the second value but only shift it 12 bits\n0000 0000 0000 0011 1111 1100 0000 0000\n\n// the 3rd is shifted 6 bits\n0000 0000 0000 0000 0000 1111 1100 0000\n\n// And the 4th is not shifted at all\n0000 0000 0000 0000 0000 0000 0011 1111\n\n// we then add them all together and each byte gets their own space\n0000 0000 1111 1111 1111 1111 1111 1111</code></pre></div>\n<p>After the extraction of the data, we need to shift the bits a little bit more to create our 3 groups of 8 bits that we can store in a proper byte array. That is done in the following way.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">// We start out with our newly created <span class=\"token number\">32</span> bit number\n0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n\n   // We <span class=\"token keyword\">then</span> bit <span class=\"token builtin class-name\">shift</span> it down <span class=\"token number\">16</span> steps and mask off everything above the 8th bit\n   0000 0000 0000 0000 0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n<span class=\"token operator\">&amp;</span>  0000 0000 0000 0000 0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n------------------------------------------\n   0000 0000 0000 0000 0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n\n   // second value is created by a <span class=\"token builtin class-name\">shift</span> by <span class=\"token number\">8</span> steps down and masked the same way\n   0000 0000 0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n<span class=\"token operator\">&amp;</span>  0000 0000 0000 0000 0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n------------------------------------------\n   0000 0000 0000 0000 0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n\n   // third we dont shift, we just mask off\n   0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n<span class=\"token operator\">&amp;</span>  0000 0000 0000 0000 0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span>\n------------------------------------------\n   0000 0000 0000 0000 0000 0000 <span class=\"token number\">1111</span> <span class=\"token number\">1111</span></code></pre></div>\n<p>All of the operations above are done with the following code. And then we just push the decoded bytes onto a new list of <code class=\"language-text\">bytes</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token keyword\">let</span> c <span class=\"token operator\">=</span> n <span class=\"token operator\">>></span> <span class=\"token number\">16</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> c1 <span class=\"token operator\">=</span> n <span class=\"token operator\">>></span> <span class=\"token number\">8</span> <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">let</span> c2 <span class=\"token operator\">=</span> n <span class=\"token operator\">&amp;</span> <span class=\"token number\">0xFF</span><span class=\"token punctuation\">;</span>\n\nbytes<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>c <span class=\"token keyword\">as</span> <span class=\"token keyword\">u8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbytes<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>c1 <span class=\"token keyword\">as</span> <span class=\"token keyword\">u8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbytes<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>c2 <span class=\"token keyword\">as</span> <span class=\"token keyword\">u8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Before we can convert this to a proper string we lastly need to remove the characters we used for padding, and then we convert the entire string to a utf-8 string that we can return.</p>\n<div class=\"gatsby-highlight\" data-language=\"rust\"><pre class=\"language-rust\"><code class=\"language-rust\"><span class=\"token comment\">// remove padding characters</span>\n<span class=\"token keyword\">for</span> _ <span class=\"token keyword\">in</span> <span class=\"token number\">0</span><span class=\"token punctuation\">..</span>suffix<span class=\"token punctuation\">.</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    bytes<span class=\"token punctuation\">.</span><span class=\"token function\">pop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// create a utf-8 string from the provided data</span>\n<span class=\"token keyword\">let</span> output <span class=\"token operator\">=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">::</span><span class=\"token function\">from_utf8</span><span class=\"token punctuation\">(</span>bytes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">unwrap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>And thats it!</p>\n<h2>Summary</h2>\n<p>So in this post we have looked closer at what base64 is and what it is used for. We also looked at how to implement our own version of a base64 encoder and decoder. There are probably many more different ways and more efficient ways you can implement this to be more effective, but i found this to be fun and a learning experience. The entire code with a working example can be found on my <a href=\"https://github.com/Tandolf/base64\">github</a>.</p>\n<p>Until next time, have a nice one.</p>","frontmatter":{"title":"Implementing base64 in rust","date":"September 10, 2022","description":"Honestly, i have a confession to make. I have used base64 numerous times, I know why you use it. I've had a vague understanding of how it is implemented. But i have never ever fully understood how it works. Until now. Lets implement a basic base64 program in Rust.","tags":"rust, binary"}},"previous":{"fields":{"slug":"/hello-world/"},"frontmatter":{"title":"Hello World"}},"next":null},"pageContext":{"id":"e6d94328-9aed-52ea-8470-6137cf37c2d0","previousPostId":"3a5d691a-1468-5f93-9c6b-c17e21a939a2","nextPostId":null}},"staticQueryHashes":["1085053114","702912328","984448874"]}